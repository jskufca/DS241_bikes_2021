---
title: "Team 1 Mapping"
author: "Jackie, Mark, Jackson"
date: "11/5/2021"
output: html_notebook
---

##Load Libraries

Here we loaded a few libraries we will be needing
```{r eval = FALSE, message = FALSE}
library(tidyverse) 
library(dsbox) 
library(lubridate)
library(janitor)
library(readr)
library(sf)
library(tmap)
```


##Our Goals
Team 1 - Mapping

Task 1 - Revisit what we have done with maps.   Identify where we have made maps in the class, and what packages we have used. 

Task 2 - Make a plot of at least some subset of the datapoints from the bike share data.

We will want to use the  `sf` package.   See if you can find a tutorial that is "our speed."

We will want to use the `tmap` package.   See if you can find a tutorial that is "our speed."

##Answering Task 1

-We have made maps in class. 

-We made a map in Lab 04. There were maps per state, and maps of the entire US.

-Some classmates were able to generate a plot in Lab 04 on an actual interactive map. This map included borders, and ability to zoom in and out. (Was it
Shreejit?)
How was this done? It could be a useful tool.

-The packages used in lab 04 were tidyverse and and dsbox

##Task 2
Here the goal is to make a plot of a subset of the datapoints from the bike share data.

Our subset will be the locations of pick-ups and drop-offs for Saturday September 4, 2021

```{r ignore}
# df1a <-  unzip(202108-capitalbikeshare-tripdata.zip) %>%
#   read_csv("https://s3.amazonaws.com/capitalbikeshare-data/index.html.csv") %>% clean_names
```


```{r download_data}
df1 <- read_csv("U:/Data Science 241/202109-capitalbikeshare-tripdata.csv") %>% clean_names
```

Here We want to get the data filtered to just Sep 4
```{r manipulate_data}
df1a = df1 %>% 
  select(rideable_type, start = started_at, end = ended_at, start_station_name:end_lng) %>%
  pivot_longer(cols =  start:end,  names_to = "type", values_to = "time")%>%
  arrange(time) %>%
  mutate(inc = case_when(
    type == "start" ~ 1,
    type == "end" ~ -1
  ), riders = cumsum(inc)) %>%
  mutate(day_of_year = yday(time)) %>%
  mutate(day_since_sep1 = day_of_year-243) %>%
  filter(day_since_sep1 == 4)
```

Here is the visualization
```{r visualization}
ggplot(df1a, mapping = aes(x = start_lat, y = start_lng)) +
  geom_point()

ggplot(df1a, mapping = aes(x = end_lat, y = end_lng)) +
  geom_point()
```
It would be beneficial if this plot were overlaid over some map of the city. Right now the points do not mean much.

##SF File Work
This is a must run
```{r}
#for laptop 
#df1 <- sf::read_sf("C:/Users/markf/Downloads/DS 241/DS241_bikes_2021/202109-capitalbikeshare-tripdata.csv") %>% clean_names

#for class
df1 <- sf::read_sf("U:/Data Science 241/202109-capitalbikeshare-tripdata.csv") %>% clean_names
```

This is a must run
```{r manipulate_data_correctly}
df1a = df1 %>% 
  select(rideable_type, start = started_at, end = ended_at, start_station_name:end_lng) %>%
  pivot_longer(cols =  start:end,  names_to = "type", values_to = "time")%>%
  arrange(time) %>%
  mutate(inc = case_when(
    type == "start" ~ 1,
    type == "end" ~ -1
  ), riders = cumsum(inc)) %>%
  mutate(day_of_year = yday(time)) %>%
  mutate(day_since_sep1 = day_of_year-243) %>%
  filter(day_since_sep1 == 4)
```
 
Here is the visualization
```{r visualization_broken}
ggplot(df1a, mapping = aes(x = start_lat, y = start_lng)) +
  geom_point()

ggplot(df1a, mapping = aes(x = end_lat, y = end_lng)) +
  geom_point()
``` 
 
This is a must run 
```{r}
#for laptop 
#sf_neighborhoods_df <- sf::read_sf("C:/Users/markf/Downloads/DS 241/DS241_bikes_2021/DC_Health_Planning_Neighborhoods.geojson")

#for class
sf_neighborhoods_df <- sf::read_sf("U:/Data Science 241/DS241_bikes_2021/DC_Health_Planning_Neighborhoods.geojson")
 View(sf_neighborhoods_df)
```

This does not need to be run
```{r}
plot(sf_neighborhoods_df) 
```

DT <- data.table(
                 place=c("Finland", "Canada", "Tanzania", "Bolivia", "France"),
                 longitude=c(27.472918, -90.476303, 34.679950, -65.691146, 4.533465),
                 latitude=c(63.293001, 54.239631, -2.855123, -13.795272, 48.603949))
# st_as_sf() ######
# sf version 0.2-7
DT_sf = st_as_sf(DT, coords = c("longitude", "latitude"), 
                 crs = 4326, relation_to_geometry = "field")
# sf version 0.3-4, 0.4-0
DT_sf = st_as_sf(DT, coords = c("longitude", "latitude"), 
                 crs = 4326, agr = "constant")
plot(DT_sf)

This is just for reference, don't need to run
```{r prepping_a_column}
df1a_sf <- df1a %>%
   filter(type == "start") %>%
  select(start_lat, start_lng) %>%
   st_as_sf(coords = c("start_lat", "start_lng"), crs = 4326)
# plot(df1a_sf)
```

This is a must run
```{r good_stuff}
df1a_start <- df1a %>%
  filter(type == "start") %>%
  select(!end_lat:end_lng) %>%
  st_as_sf(coords = c("start_lng", "start_lat"), crs = 4326)
 # mutate(geometry = df1a_sf$geometry)
```

This is another prep column, don't need to run
```{r}
#df1a_start_geometry <- df1a_start %>%
 select(geometry)
```

I believe my coordinate reference system is already good! Don't need to run this
```{r}
df1a_start_geometry_adj=df1a_start_geometry %>% st_transform(4326)
```

This is the Join! Right now it just return NA for every entry in the right table
```{r}
df_joined = st_join(df1a_start, sf_neighborhoods_df)
#df_joined = st_join(sf_neighborhoods_df, df1a_start, join = st_within)
```

##trying to get coordinates
This bit isn't working
```{r}
tmap_mode("view")
tm_shape(df1a_start) + tm_dots()
```


I already go my coordinates
```{r}
df2a_start <- df1a %>%
  filter(type == "start") %>%
```

This one is nonsense
```{r}
st_contains(sfc_POLYGON('list(c(-77.0030632859585, -77.002658285435, -77.0024462850957, -77.0026802862879, -77.0028672859204, -77.0028882857458, -77.0029172864853, -77.0029442855532, -77.0029672857016, -77.0029952858469, -77.0030572859784, -77.0031532858972, -77.0032512854388, -77.0033742858258, -77.0035582861069, -77.0033042858352, -77.0025222854536, -77.0020362864692, -77.0015202848765, -77.0009542849891, -77.000708284669, -77.0005722857907, -77.0005712854765, -77.0005712853444, -77.0005712854449, -77.0005722852449, -77.0005712847299,  -77.0005702851997, -77.0005722848971, -77.0005732847886, -77.0005712844668, -77.0005712853696, -77.0020332859298, -77.0035152856101, -77.0035152855639, -77.0035122857179, -77.0035122852374, -77.0035112858301, -77.0035122852743, -77.0035122852804, -77.0035132851626, -77.0035112855808, -77.0035082845951, -77.0035102849692, -77.0035112849009, -77.0035092851224, -77.0035082849494, -77.0035092852313, -77.0035112857158, -77.0035102846751, -77.003510285363, -77.0035072846956, -77.0035062848773, -77.0035062847198,  -77.0035092850045, -77.0035122854215, -77.0041552855589, -77.0043732861174, -77.0045822853452, -77.0047902853769, -77.004939285003, -77.0049672843183, -77.0051412861204, -77.0052822855006, -77.00533328554, -77.0056032854652, -77.0056932850362, -77.0058832862734, -77.0060092853832, -77.0062092861415, -77.0063732856329, -77.0069272857522, -77.0077012862864, -77.0080562870518, -77.0082852857771, -77.008811286126, -77.009028286053, -77.0090282870401, -77.0090202871613, -77.009016287414, -77.009008286179,  -77.0089922864736, -77.0090002864277, -77.0090042865697, -77.009087286603, -77.0091732871435, -77.0093032863805, -77.009555286719, -77.0101002874203, -77.0101282872702, -77.0102082874017, -77.0121622876336, -77.0122432867857, -77.0126252877208, -77.0132422873253, -77.0134292884139, -77.0136522872908, -77.0141612880239, -77.0146552886003, -77.0148162882009, -77.0148672891399, -77.0149032881283, -77.0151772889855, -77.0153272880453, -77.0153972890569, -77.0154162889769, -77.0154432883728, -77.0154882888025,  -77.0157482888637, -77.0159102886171, -77.0159862888484, -77.0161562885273, -77.0161652883517, -77.0162972889141, -77.0165162887686, -77.016574288941, -77.016613289347, -77.0166312888342, -77.016829288392, -77.0169532892476, -77.0170972893045, -77.0171262901802, -77.0172182900938, -77.0173382886533, -77.0173652902749, -77.0174622896253, -77.0175072891007, -77.0176422899777, -77.0177282894286, -77.0177662900311, -77.0178012894005, -77.017824289898, -77.0178962902941, -77.0181112901391, -77.0178472892725,  -77.0173282906611, -77.0170682890271, -77.016902288587, -77.0167592895569, -77.016361289556, -77.0162252891488, -77.0160982889005, -77.0158592887603, -77.0157082892696, -77.0151802888937, -77.0145512887419, -77.0142102883256, -77.0140872890344, -77.0140722894608, -77.0140612889246, -77.0140542881499, -77.0140522886394, -77.0140542887034, -77.0140872891192, -77.0141692886936, -77.0141932884328, -77.0142462886468, -77.0142562885189, -77.0142732892957, -77.0142802886268, -77.0142932885616, -77.0143122892215,  -77.014334288485, -77.0143422886294, -77.0143762888689, -77.0143842896575, -77.0144162883534, -77.0144222896236, -77.0145032879749, -77.0145682885092, -77.014573288774, -77.0145772897601, -77.0145802889244, -77.0146172896611, -77.0146212879375, -77.0146272892299, -77.0146382896684, -77.0146922894232, -77.0147432884373, -77.014751289367, -77.014804288551, -77.0148752892698, -77.0149282893323, -77.0149372886341, -77.0146322899338, -77.014561290297, -77.0144202895619, -77.0142802887739, -77.0140702896314,  -77.0139312893953, -77.013785288896, -77.0136392897305, -77.0135672878524, -77.013424289029, -77.0132832886156, -77.0132142883492, -77.0130702883697, -77.0129762888684, -77.0128842889132, -77.0127382885036, -77.0127082891098, -77.0126762884354, -77.0126442884879, -77.0122592889766, -77.0121502881325, -77.0121502884041, -77.0121482883287, -77.0121482886271, -77.0121492886779, -77.0121472886179, -77.0121482885361, -77.0121482879358, -77.012148288097, -77.0121462881307, -77.012146288196, -77.0121462884968,  -77.0121432897002, -77.0121442880353, -77.0119912884266, -77.0114062882363, -77.0111582883434, -77.0101432888099, -77.0095772879159, -77.0092362876159, -77.009046287413, -77.0089412874725, -77.0084082876741, -77.008113286601, -77.0079712878128, -77.0079042883234, -77.007317287048, -77.0069002870406, -77.0065682863935, -77.0063722871537, -77.0062952862913, -77.0062582872915, -77.0062102873342, -77.0061182869586, -77.006058287628, -77.0059922870936, -77.0059662862956, -77.0059102867615, -77.0058492868743,  -77.0057892866365, -77.0057612872653, -77.0057322861878, -77.0056982870094, -77.0056642865666, -77.005617287244, -77.0055902874987, -77.0054782856366, -77.0054492866504, -77.0053642861364, -77.005091286377, -77.0048832866273, -77.0047172856981, -77.0046802867732, -77.0046052864966, -77.0044572868371, -77.0043822859925, -77.0042712861304, -77.0041962861922, -77.0040452855924, -77.003926286711, -77.0038002864, -77.0036312863002, -77.0035092855306, -77.0033992865692, -77.0032422854514, -77.0031272861778,  -77.0030632859585, 38.9256037923858, 38.9256017923261, 38.9256017924556, 38.9254687918872, 38.9253687928592, 38.9253567932615, 38.9253367929475, 38.9253147922669, 38.925290792398, 38.9252507919333, 38.9250427927485, 38.9247277917909, 38.9244207923205, 38.9240247920747, 38.9234367915288, 38.9234437922639, 38.9234467924007, 38.9234457923933, 38.9234447918853, 38.9234477925918, 38.923447792657, 38.9234467923548, 38.9233677921928, 38.9229927920691, 38.9223777916067, 38.9216787918205, 38.9213027922228,  38.9212277911628, 38.9203827921452, 38.9202357914459, 38.9198357918784, 38.9197687913143, 38.9192517915387, 38.9187337909139, 38.9186597914269, 38.9181127910707, 38.9178397907891, 38.9176827913708, 38.9176357909348, 38.9175627902316, 38.9172907909431, 38.9170047905305, 38.9167107901701, 38.9163547897883, 38.9162887913282, 38.9159687900315, 38.9156637903784, 38.9155757896151, 38.9148277908657, 38.9147537902296, 38.9146067899455, 38.9140827908443, 38.9133447906729, 38.9131657904793, 38.9127607900994,  38.9126077895541, 38.9126097896915, 38.9126077891995, 38.9118687893049, 38.9111237894215, 38.9105887890069, 38.9104907888694, 38.9098597890865, 38.9093657899457, 38.9092187894511, 38.9093277890475, 38.9093657892141, 38.9094477883928, 38.9095007898947, 38.9095867888575, 38.9096557895743, 38.9098897891898, 38.9102207894814, 38.9103707888015, 38.9104667887743, 38.9106917899534, 38.910790789147, 38.9103887890211, 38.9096457887422, 38.9090957884823, 38.9085737886686, 38.9076917877016, 38.9073717880399,  38.9072817892635, 38.9072767882697, 38.9072717886703, 38.9072427895233, 38.9071467874781, 38.906991788453, 38.906982788377, 38.9069547879685, 38.9062767884301, 38.9063017888379, 38.9061627881799, 38.9059637884605, 38.9058887877936, 38.9058207877437, 38.9056547876905, 38.9054787885901, 38.9054247879862, 38.9055557882734, 38.9056597879174, 38.9064657871947, 38.9068917887896, 38.9070857890202, 38.9071537888509, 38.9072427883333, 38.9074047879527, 38.9081227883279, 38.9085817889433, 38.9087847884085,  38.9092547884118, 38.9096497884592, 38.9096497881362, 38.9102537888198, 38.9104117886418, 38.9105287885336, 38.9105807888861, 38.9111277893311, 38.9114767889176, 38.9118727886974, 38.9119497888749, 38.9122017887524, 38.9125387893433, 38.9126127888457, 38.9128827886719, 38.9130047891964, 38.9133827903194, 38.9136157897984, 38.9137257893472, 38.9138277899349, 38.9138947893189, 38.9140957892318, 38.9146537893594, 38.9145387890227, 38.9143247896549, 38.9142157898892, 38.9141447894761, 38.9140827899255,  38.9139107893436, 38.9138557893241, 38.9138027888831, 38.9137007886304, 38.9136347897353, 38.9134097890151, 38.9131407888466, 38.9129967897314, 38.9129427894994, 38.9129677894486, 38.9129937899661, 38.9130207893641, 38.9130477892861, 38.9130747892898, 38.9133517894825, 38.9140917897603, 38.9143187901885, 38.9147527896334, 38.9148427907008, 38.9149957895822, 38.9150617899885, 38.9151797902771, 38.9153177894574, 38.9154907901493, 38.9155767900527, 38.9158937897343, 38.9159717902276, 38.9162287906766,  38.9162867900931, 38.9170027899749, 38.9175877902934, 38.9176447898877, 38.9176997897563, 38.9177297910668, 38.9180307908196, 38.9180687897109, 38.9181147900008, 38.9181907902199, 38.9186707906279, 38.919106790727, 38.9191817908124, 38.9196707899641, 38.9202367905015, 38.9206257903214, 38.9206757910136, 38.9207197908032, 38.9207307909572, 38.9207547914241, 38.9207807914469, 38.9208237911446, 38.9208557907367, 38.9208927917364, 38.9209337905609, 38.9209557910827, 38.9210017911627, 38.9210517910997,  38.9210777913218, 38.9211377911449, 38.9211797916801, 38.9212237917672, 38.9212967915397, 38.9213057907454, 38.9213117909512, 38.9213137914517, 38.9213147913053, 38.9213137915067, 38.9214887911735, 38.9220087912907, 38.9223827915624, 38.9225457920039, 38.9230787910281, 38.9233847918041, 38.9234827916481, 38.9236317909765, 38.924169792889, 38.9241997922855, 38.924700791697, 38.9258027920285, 38.9262897928247, 38.9262977916841, 38.9263547918261, 38.9263857925588, 38.9265207925041, 38.9265987920463,  38.9266467927258, 38.9266747924885, 38.9266857924057, 38.926743792611, 38.9267757929906, 38.926792792449, 38.9268007930075, 38.9268787925901, 38.9269317924902, 38.9269767923999, 38.9270027922456, 38.9270177918876, 38.9269067922819, 38.9268067918384, 38.9266767926146, 38.9265917921421, 38.9265137925334, 38.9264867931242, 38.9264347920846, 38.9263867926499, 38.9263457920325, 38.9263277925475, 38.9263117929512, 38.926292792696, 38.9262757928403, 38.9262537922953, 38.9262427927464, 38.926201792193, 38.9261927925514,  38.9261637925193, 38.9260747924276, 38.9260047920432, 38.9259507923123, 38.9259377919833, 38.9259137923021, 38.925863792872, 38.9258397924843, 38.9258027932417, 38.9257797920947, 38.925738792685, 38.9257107932634, 38.9256837921828, 38.9256547919013, 38.9256377924303, 38.9256247927395, 38.9256117931333, 38.9256057927883, 38.9256037923858))'), sfc_POINT('c(38.9029315735912, -76.9984048604965)')); st_contains()
#st_contains(start_lat:start_lng, OBJECTID==5))
```


```{r}
df1_fruit=tibble(fruit=c("apple","banana","cherry"),cost=c(1.5,1.2,2.25))
df2_fruit=tibble(fruit=c("apple","apple","cherry","lemon"),
           desert=c("pie","cobbler","cobbler","cheesecake"),
           cal=c(400,430,500,550))
df1_fruit
```

```{r}
df2_fruit
```

```{r}
left_join(df1_fruit,df2_fruit,by="fruit")
```

