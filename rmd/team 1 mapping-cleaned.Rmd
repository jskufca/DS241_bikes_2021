---
title: "Team 1 Mapping-Cleaned"
author: "Jackie, Mark, Jackson"
date: "11/5/2021"
output: html_notebook
---

##Load Libraries

Here we loaded a few libraries we will be needing
```{r eval = FALSE, message = FALSE}
library(tidyverse) 
library(dsbox) 
library(lubridate)
library(janitor)
library(readr)
library(sf)
library(tmap)
```

##SF File Work
Our goal is to join up the bikeshare data with neighborhood data

first we need to load bikeshare data
```{r load_bikeshare}
#for laptop 
#df1 <- sf::read_sf("C:/Users/markf/Downloads/DS 241/DS241_bikes_2021/202109-capitalbikeshare-tripdata.csv") %>% clean_names

#for class
df1 <- sf::read_sf("U:/Data Science 241/202109-capitalbikeshare-tripdata.csv") %>% clean_names
```

Here we need to get the data frame in a format we can use, and select only bikes taken out and returned on September 4 for this example
```{r manipulate_data}
df1a = df1 %>% 
  select(rideable_type, start = started_at, end = ended_at, start_station_name:end_lng) %>%
  pivot_longer(cols =  start:end,  names_to = "type", values_to = "time")%>%
  arrange(time) %>%
  mutate(inc = case_when(
    type == "start" ~ 1,
    type == "end" ~ -1
  ), riders = cumsum(inc)) %>%
  mutate(day_of_year = yday(time)) %>%
  mutate(day_since_sep1 = day_of_year-243) %>%
  filter(day_since_sep1 == 4)
```

Here we need to get a bikeshare data frame which includes only bikes rented out (not returned) on September 4. The location that these bikes were taken out of is transformed into a column with point geometry. The new data frame created is an SF object as well, which will allow us to join it with the neighborhood data frame.
```{r create_geometry}
df1a_start <- df1a %>%
  filter(type == "start") %>%
  select(!end_lat:end_lng) %>%
  st_as_sf(coords = c("start_lng", "start_lat"), crs = 4326)
```

Now we need to load in neighborhood data 
```{r load_neighborhoods}
#for laptop 
#sf_neighborhoods_df <- sf::read_sf("C:/Users/markf/Downloads/DS 241/DS241_bikes_2021/DC_Health_Planning_Neighborhoods.geojson")

#for class
sf_neighborhoods_df <- sf::read_sf("U:/Data Science 241/DS241_bikes_2021/DC_Health_Planning_Neighborhoods.geojson")
```

This is the Join! This assigns which neighborhood each bike was taken out of. Entries with "NA" are most likely bikes taken out at locations not directly within the city.
```{r}
df_joined = st_join(df1a_start, sf_neighborhoods_df)
view(df_joined)
```



